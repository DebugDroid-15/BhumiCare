<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŒ± Smart Agronomist â€” Full Dashboard</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Canvas Gauges & Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/canvas-gauges/gauge.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { margin:0; font-family:'Poppins',sans-serif; background:#f0f4f8; color:#1b5e20; }
header { text-align:center; padding:16px 0; background:#2e7d32; color:white; font-size:24px; font-weight:700; box-shadow:0 2px 6px rgba(0,0,0,0.15);}
.container { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; padding:16px; }
.card { background:#fff; border-radius:12px; padding:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1); text-align:center; }
.trend-container { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:16px; padding:16px; }
.map-container { width:100%; height:500px; margin-top:16px; border-radius:12px; overflow:hidden; }
</style>
</head>
<body>

<header>ðŸŒ± Smart Agronomist Dashboard</header>

<div class="container" id="gauges">
  <!-- Gauges will be inserted here -->
</div>

<div class="trend-container" id="trends">
  <!-- Trend charts -->
</div>

<div class="map-container" id="map"></div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_API_KEY",
  authDomain: "bhumicare-b6713.firebaseapp.com",
  databaseURL: "https://bhumicare-b6713-default-rtdb.firebaseio.com",
  projectId: "bhumicare-b6713",
  storageBucket: "bhumicare-b6713.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const sensorRef = ref(db, "SensorData");

// Gauges
const gaugeSettings = (min,max,units)=>({
  renderTo:null, width:180, height:180, units:units, minValue:min, maxValue:max,
  majorTicks:[min,(min+max)/2,max], minorTicks:5, strokeTicks:true,
  highlights:[{from:min,to:(min+max)/3,color:'#d32f2f'},{from:(min+max)/3,to:2*(min+max)/3,color:'#fbc02d'},{from:2*(min+max)/3,to:max,color:'#4caf50'}],
  colorPlate:'#f5f5f5', colorMajorTicks:'#1b5e20', colorMinorTicks:'#607d8b', colorNumbers:'#1b5e20',
  colorNeedle:'#d32f2f', colorNeedleEnd:'#d32f2f', animationDuration:500, animationRule:'linear'
});

const gaugeIds = ["moistureNPK","tempNPK","ec","N","P","K","fertilityIndex","TDS","salinityIndex","moistureStress","tempStress","soilOrganicProxy","temperatureDHT","humidityDHT","mq2Raw","ldrRaw","soilMoistureRaw"];
const gaugeLabels = ["Soil Moisture (%)","Soil Temp (Â°C)","EC (ÂµS/cm)","N (ppm)","P (ppm)","K (ppm)","Fertility Index","TDS (ppm)","Salinity Index","Moisture Stress","Temp Stress","Soil Organic Proxy","DHT Temp (Â°C)","DHT Humidity (%)","MQ2 Gas","LDR Light","Soil Moisture Analog"];
const gaugeMax = [100,50,2000,200,100,100,100,1000,100,100,100,10,50,100,500,1000,100];

const gauges = {};
const container = document.getElementById("gauges");
gaugeIds.forEach((id,i)=>{
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `<h3>${gaugeLabels[i]}</h3><canvas id="${id}Gauge"></canvas>`;
  container.appendChild(card);
  gauges[id] = new RadialGauge({...gaugeSettings(0,gaugeMax[i],gaugeLabels[i].includes('%')?'%':'') , renderTo: document.getElementById(id+'Gauge')}).draw();
});

// Trends
const trendsContainer = document.getElementById("trends");
const trendCharts = {};
gaugeIds.forEach((id,i)=>{
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `<h4>${gaugeLabels[i]} Trend</h4><canvas id="${id}Trend"></canvas>`;
  trendsContainer.appendChild(card);
  const ctx = document.getElementById(id+'Trend').getContext('2d');
  trendCharts[id] = new Chart(ctx,{
    type:'line',
    data:{labels:[], datasets:[{label:gaugeLabels[i],data:[], borderColor:'#2e7d32', backgroundColor:'rgba(46,125,50,0.2)', fill:true, tension:0.3}]},
    options:{responsive:true, plugins:{legend:{display:false}}, scales:{x:{display:true,title:{display:true,text:'Time'}}, y:{beginAtZero:true}}}
  });
});

// Map initialization
let map, marker;
function initMap(lat=20.5937,lng=78.9629){
  map = new google.maps.Map(document.getElementById("map"), { center:{lat,lng}, zoom:8 });
  marker = new google.maps.Marker({ position:{lat,lng}, map:map, title:"Field Location" });
}

// Real-time updates
onValue(sensorRef, (snapshot)=>{
  const data = snapshot.val();
  if(!data) return;
  const keys = Object.keys(data);
  const latest = data[keys[keys.length-1]];

  // Update gauges
  gaugeIds.forEach(id=>{
    if(latest[id]!=null) gauges[id].value = latest[id];
  });

  // Update trends
  const timestamp = new Date().toLocaleTimeString();
  gaugeIds.forEach(id=>{
    if(latest[id]!=null){
      const chart = trendCharts[id];
      chart.data.labels.push(timestamp);
      chart.data.datasets[0].data.push(latest[id]);
      if(chart.data.labels.length>20){ chart.data.labels.shift(); chart.data.datasets[0].data.shift(); }
      chart.update();
    }
  });

  // Update map
  if(latest.gpsLat && latest.gpsLng){
    const lat = parseFloat(latest.gpsLat);
    const lng = parseFloat(latest.gpsLng);
    marker.setPosition({lat,lng});
    map.setCenter({lat,lng});
    map.setZoom(15);
  }
});

window.initMap = initMap;
</script>

<!-- Google Maps JS -->
<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7YHaxjiMaPXsWuGiQHO4ElY2SST7K_hw&callback=initMap"></script>

</body>
</html>
