<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŒ± Smart Agronomist â€” Full Futuristic Gauge Dashboard</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Highcharts -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>

<style>
body { margin:0; font-family:'Poppins', sans-serif; background:#0b0b0f; color:#fff; }
header { text-align:center; padding:20px 0; background:#1b1b2f; color:#00ffd5; font-size:28px; font-weight:700; box-shadow:0 4px 12px rgba(0,0,0,0.3);}
.gauges { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; padding:20px; }
.gauge-card { background:#141426; border-radius:16px; padding:16px; box-shadow:0 6px 16px rgba(0,0,0,0.4); text-align:center; }
.gauge-title { font-size:16px; font-weight:600; color:#00ffd5; margin-bottom:8px; }
.map-container { margin:20px auto; max-width:1200px; height:500px; border-radius:12px; overflow:hidden; }
</style>
</head>
<body>

<header>ðŸŒ± Smart Agronomist â€” Full Futuristic Gauge Dashboard</header>

<div class="gauges">
  <div class="gauge-card"><div class="gauge-title">Soil Moisture (%)</div><div id="soilMoistureGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">Temperature (Â°C)</div><div id="temperatureGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">Humidity (%)</div><div id="humidityGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">EC (dS/m)</div><div id="ecGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">pH Level</div><div id="phGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">Fertility Index</div><div id="fertilityGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">N (ppm)</div><div id="nGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">P (ppm)</div><div id="pGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">K (ppm)</div><div id="kGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">TDS (ppm)</div><div id="tdsGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">Salinity Index</div><div id="salinityGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">Moisture Stress</div><div id="moistureStressGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">Temperature Stress</div><div id="tempStressGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">Soil Organic Proxy (%)</div><div id="soilOrganicGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">DHT Temperature (Â°C)</div><div id="dhtTempGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">DHT Humidity (%)</div><div id="dhtHumidityGauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">MQ2 Gas (ppm)</div><div id="mq2Gauge"></div></div>
  <div class="gauge-card"><div class="gauge-title">LDR Light (lux)</div><div id="ldrGauge"></div></div>
</div>

<div class="map-container">
  <iframe id="fieldMap" loading="lazy" allowfullscreen 
    src="https://www.google.com/maps?q=20.5937,78.9629&z=10&output=embed" 
    title="Field Location"></iframe>
</div>

<script type="module">
  import { app, db } from './firebase-config.js';
  import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

  // Highcharts solid gauge creator
  const createGauge = (id, min, max, unit) => {
    return Highcharts.chart(id, {
      chart: { type: 'solidgauge', backgroundColor:'transparent' },
      title: null,
      pane: { center:['50%','50%'], size:'90%', startAngle:-90, endAngle:90,
        background:{ backgroundColor:'#22223b', innerRadius:'60%', outerRadius:'100%', shape:'arc' } },
      tooltip: { enabled:false },
      yAxis: {
        min:min,
        max:max,
        stops:[[0.1,'#ff0000'],[0.5,'#f7c600'],[0.9,'#00ff99']],
        lineWidth:0, tickWidth:0, minorTickInterval:null,
        labels:{ y:16, style:{ color:'#00ffd5', fontSize:'16px' } }
      },
      plotOptions:{
        solidgauge:{ dataLabels:{ y:0, borderWidth:0, useHTML:true,
          format:`<div style="text-align:center"><span style="font-size:22px;color:#00ffd5">{y}</span><br/><span style="font-size:14px;color:#aaa">${unit}</span></div>` } }
      },
      series:[{ name:id, data:[0] }]
    });
  };

  // Initialize all gauges
  const gauges = {
    soilMoisture: createGauge('soilMoistureGauge',0,100,'%'),
    temperature: createGauge('temperatureGauge',0,50,'Â°C'),
    humidity: createGauge('humidityGauge',0,100,'%'),
    ec: createGauge('ecGauge',0,5,'dS/m'),
    ph: createGauge('phGauge',0,14,'pH'),
    fertility: createGauge('fertilityGauge',0,100,'Index'),
    N: createGauge('nGauge',0,200,'ppm'),
    P: createGauge('pGauge',0,100,'ppm'),
    K: createGauge('kGauge',0,100,'ppm'),
    TDS: createGauge('tdsGauge',0,1000,'ppm'),
    salinity: createGauge('salinityGauge',0,100,'Index'),
    moistureStress: createGauge('moistureStressGauge',0,100,'Index'),
    tempStress: createGauge('tempStressGauge',0,100,'Index'),
    soilOrganic: createGauge('soilOrganicGauge',0,10,'%'),
    dhtTemp: createGauge('dhtTempGauge',0,50,'Â°C'),
    dhtHumidity: createGauge('dhtHumidityGauge',0,100,'%'),
    mq2: createGauge('mq2Gauge',0,500,'ppm'),
    ldr: createGauge('ldrGauge',0,1000,'lux')
  };

  // Firebase realtime update
  const sensorsRef = ref(db,'SensorData');
  onValue(sensorsRef, snapshot=>{
    const data = snapshot.val(); if(!data) return;
    const keys = Object.keys(data);
    const latest = data[keys[keys.length-1]];

    gauges.soilMoisture.series[0].points[0].update(latest.moistureNPK || 0);
    gauges.temperature.series[0].points[0].update(latest.tempNPK || 0);
    gauges.humidity.series[0].points[0].update(latest.humidityDHT || 0);
    gauges.ec.series[0].points[0].update(latest.ec || 0);
    gauges.ph.series[0].points[0].update(latest.pH || 0);
    gauges.fertility.series[0].points[0].update(latest.fertilityIndex || 0);
    gauges.N.series[0].points[0].update(latest.N || 0);
    gauges.P.series[0].points[0].update(latest.P || 0);
    gauges.K.series[0].points[0].update(latest.K || 0);
    gauges.TDS.series[0].points[0].update(latest.TDS || 0);
    gauges.salinity.series[0].points[0].update(latest.salinityIndex || 0);
    gauges.moistureStress.series[0].points[0].update(latest.moistureStress || 0);
    gauges.tempStress.series[0].points[0].update(latest.tempStress || 0);
    gauges.soilOrganic.series[0].points[0].update(latest.soilOrganicProxy || 0);
    gauges.dhtTemp.series[0].points[0].update(latest.temperatureDHT || 0);
    gauges.dhtHumidity.series[0].points[0].update(latest.humidityDHT || 0);
    gauges.mq2.series[0].points[0].update(latest.mq2Raw || 0);
    gauges.ldr.series[0].points[0].update(latest.ldrRaw || 0);

    if(latest.gpsLat && latest.gpsLng){
      document.getElementById('fieldMap').src = `https://www.google.com/maps?q=${latest.gpsLat},${latest.gpsLng}&z=15&output=embed`;
    }
  });

</script>
</body>
</html>
